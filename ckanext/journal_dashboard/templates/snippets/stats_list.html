{#
    Snippet for display summary information for a journal.
    Lists each dataset and each resource per dataset

    input:
        organization - dict of metadata for the organization
#}
{% set downloads = h.journal_resource_downloads(organization['id']) %}
<h1>
    Stats go here
</h1>
<ul>
    {% for package in organization['packages'] %}
        <li><strong><a href='/dataset/{{ package["name"] }}'>{{ package['title']|truncate(35) }}</a></strong></li>
        Views: {{ h.package_tracking(package['id']) }}
        <ul>
        {% if package['num_resources'] > 0 %}
            {% for item in h.get_resources(package['id']) %}
                <li>
                    <a href="/dataset/{{ item['package_id'] }}/resource/{{ item['id'] }}">
                    {% if item['name']|length > 40 %}
                        {% set name = [item['name'][:20], item['name'][-20:]]|join('...') %}
                    {% else %}
                        {% set name = item['name'] %}
                    {% endif %}

                    {% if item['name'] == '' %}
                        {{ item['url'] }}</a> <a href="" target="_blank"></a>
                    {% else %}
                        {{ name }}</a>
                    {% endif %}
                    {% set stats = h.match_resource_downloads(item['url'], downloads) %}
                    {% if stats %}
                        Downloads: {{ stats }}
                    {% endif %}
                </li>

            {% endfor %}
        {% else %}
            <li>0 Resources</li>
        {% endif %}
        </ul>
    {% endfor %}
</ul>
